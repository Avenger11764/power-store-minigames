<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Store Arcade</title>
    <!-- 1. The required Telegram Web App script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-color: #1a1a1a; /* A dark background */
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            text-align: center;
        }
        #game-frame {
            flex-grow: 1; /* The iframe will take up most of the space */
            border: none;
            width: 100%;
            background-color: #000;
        }
        #controls {
            padding: 12px;
            background-color: #2c2c2e;
            border-top: 1px solid #444;
            flex-shrink: 0;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 10px;
            border: none;
            background-color: #007aff;
            color: white;
            transition: background-color 0.2s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        p {
            margin: 0 0 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <!-- The iframe that will load the external game -->
    <iframe id="game-frame" src=""></iframe>

    <!-- Your own controls that can talk to the bot -->
    <div id="controls">
        <p>Finished playing? Claim your reward!</p>
        <button onclick="claimReward()">üéÅ Claim Reward</button>
    </div>

    <script>
        // A map of game identifiers to their full URLs
        const gameUrls = {
            'om-nom-run': 'https://play.famobi.com/om-nom-run',
            'cannon-balls-3d': 'https://play.famobi.com/cannon-balls-3d',
            'tower-crash-3d': 'https://play.famobi.com/tower-crash-3d',
            '3d-free-kick': 'https://play.famobi.com/3d-free-kick',
            'totemia-cursed-marbles': 'https://play.famobi.com/totemia-cursed-marbles',
            'moto-x3m': 'https://play.famobi.com/moto-x3m'
        };

        // NEW: Variable to store the time when the game started
        let startTime = Date.now();

        // This code runs when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const gameId = params.get('game');
            const gameFrame = document.getElementById('game-frame');
            const gameUrl = gameUrls[gameId];

            if (gameUrl) {
                gameFrame.src = gameUrl;
            } else {
                document.body.innerHTML = '<p>Error: Game not found.</p>';
            }
        });

        // The JavaScript function that sends data to your bot
        function claimReward() {
            const tg = window.Telegram.WebApp;
            const params = new URLSearchParams(window.location.search);
            const gameId = params.get('game');
            
            // NEW: Calculate how many seconds the user played
            const endTime = Date.now();
            const secondsPlayed = Math.round((endTime - startTime) / 1000);

            // The data we will send back.
            const dataToSend = {
                game: gameId || 'unknown_game',
                action: 'claim_time_reward', // NEW action name
                duration: secondsPlayed      // NEW: Send the duration
            };

            // Send the data string to your Python bot and close the window
            tg.sendData(JSON.stringify(dataToSend));
            tg.close();
        }
    </script>

</body>
</html>
